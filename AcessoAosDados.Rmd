---
title: "Acesso aos dados da série FlorestaR"
author: "Luiz Carlos Estraviz Rodriguez"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
if(!require(tidyverse)){
  install.packages('tidyverse', dependencies = TRUE)
  require(tidyverse)
}
```

# Série FlorestaR

O projeto *FlorestaR* reúne estudantes e professores interessados no **uso do R como ferramenta de análise de dados florestais**. Para isso, os membros do projeto trabalham como autores e redigem coletivamente uma coleção de livros.

# Livros

A coleção está em constante evolução, e no momento é constituida pelos seguintes volumes:

-   **Vol_01** Análise exploratória de dados florestais
-   **Vol_02** Análise quantitativa de dados florestais
-   **Vol_03** Amostragem para fins de inventário florestal
-   **Vol_04** Processamento de dados LiDAR para o monitoramento de florestas

# Conjuntos de dados

Os dados usados para ilustrar os exemplos estão organizados da seguinte forma:

| Pasta        | Conteúdo                                       |
|:-------------|:-----------------------------------------------|
| 1_Amazonia   | Árvores inventariadas na Amazônia              |
| 2_Cubadas    | Árvores cubadas para estudos de volumetria     |
| 3_Corredores | Ávores inventariadas em corredores ecológicos  |
| 4_Eucalyptus | Árvores inventariadoas em plantio de eucalipto |
| 5_Lidar      | Nuvens de pontos gerada por sobrevoos LiDAR    |

# Como acessar os dados dos exercícios

Os dados no [github](https://github.com/LuizEstraviz/FlorestaR_dados) podem ser acessados diretamente do seu código R. Em seguida, como os dados foram bem estruturada (seguem as regras [tidy](https://r4ds.had.co.nz/tidy-data.html)), é possível explorá-los com funções **tidyverse**. Por exemplo, o conteúdo da planilha [Censo_UPA04.csv](https://github.com/LuizEstraviz/LivroDados/tree/main/1_Amazonia) pode ser armazenado em um objeto `dados`, da seguinte forma:

```{r ledados, include=FALSE}
gitOnde = "https://github.com/LuizEstraviz/LivroDados/blob/main/1_Amazonia/"
gitNome = "Censo_UPA04.csv"
gitArqv = paste0(gitOnde, gitNome, "?raw=true")

dados = readr::read_csv(gitArqv)

# O resultado é uma tibble com 20.321 linhas e 19 variáveis
```

As primeira três linhas definem o endereço URL acrescido de `?raw=true`, que é repassado para a função `read_csv()` do pacote **readr**. Esse pacote do **tidyverse** permite fazer a leitura remota no repositório [github](https://github.com/LuizEstraviz/LivroDados). A tabela de dados resultante registra medições reais de um censo de árvores realizado em 2010, numa área de floresta amazônica no estado de Rondônia, próxima à divisa com o Acre. A função `str()` do R nos dá informação completa sobre a estrutura de `dados`:

```{r colunas, message=FALSE, echo=TRUE}
str(dados)
```

Recomenda-se o uso das demais funções **tidyverse** para a análise de `dados`. Por exemplo, sabendo que a classe de DAP e a destinação de cada árvore estão registradas nas colunas `ClasseDAP` e `Destino`, respectivamente, e que o código [PAB]{.smallcaps} indentifica as árvores destinadas para abate, o uso de funções **tidyr** pode nos ajudar a contar o número de árvores por classe de DAP destinadas para abate. Para isso, basta um [pipe](https://r4ds.had.co.nz/pipes.html) com três funções (`filter`, `group_by` e `count`):

```{r arvporDAP, message=FALSE, echo=TRUE}
dados %>%
  filter (Destino=="PAB") %>%
  group_by(ClasseDAP) %>% 
  count()
```

Mais um exemplo, quais seriam as cinco espécies de árvores destinadas para abate de maior DAP médio? Um [pipe](https://r4ds.had.co.nz/pipes.html) com as funções `filter`, `select`, `group_by`, `summarize`, `arrange` e `head` gera o resultado desejado:

```{r top5Dap, message=FALSE, echo=TRUE}
dados %>%
  filter (Destino=="PAB") %>% 
  select(Especie, DAP) %>% 
  group_by(Especie) %>% 
  summarize(DAPmedio = mean(DAP)) %>% 
  arrange(desc(DAPmedio)) %>%
  head(5)
```

Uma boa análise de dados não pode dispensar a visualização gráfica dos resultados às nossas perguntas. Para isso, o **tidyverse** oferece as funções gráficas do pacote **ggplot2**. Como exemplo, vejamos quais seriam as dez espécies com árvores destinadas para abate de maior altura máxima.

```{r grafTop10Alt, message=FALSE, echo=TRUE}

top10Dap <- dados %>%
  filter (Destino=="PAB") %>% 
  select(Especie, Altura) %>% 
  group_by(Especie) %>% 
  summarize(ALTmax = max(Altura)) %>% 
  head(10)

top10Dap %>% 
  ggplot() +
  geom_col(mapping=aes(x=reorder(Especie, -ALTmax), y=ALTmax)) +
  theme(axis.text.x = element_text(angle = 90)) +
  labs(x = "Espécie", y = "Altura máxima")
  
```
